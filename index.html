<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#121212"> 
  <title>Valley Hemp OS</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: -apple-system, sans-serif; padding: 15px; margin: 0; padding-bottom: 100px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; max-width: 1200px; margin: 0 auto; }
    @media (max-width: 350px) { .grid { grid-template-columns: 1fr; } }

    .card { background: #1e1e1e; border-radius: 12px; padding: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
    .brand { color: #00e676; font-weight: bold; text-transform: uppercase; font-size: 0.9em; letter-spacing: 0.5px; }
    .item-name { font-size: 1.3em; font-weight: bold; margin: 5px 0 10px 0; color: #fff; }
    .direct-link { display: block; width: 100%; text-align: center; background: #00e676; color: #000; padding: 12px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-bottom: 15px; }
    .vendor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
    
    /* VENDOR BUTTONS */
    .vendor-btn { text-align: center; background: #333; color: #bbb; padding: 10px; border-radius: 6px; text-decoration: none; font-size: 0.85em; border: 1px solid #444; transition: 0.2s; }
    
    /* HIGHLIGHT COLORS */
    .vendor-btn.wcg-primary { border: 1px solid #00e676; color: #00e676; background: #1a2e23; font-weight: bold; }
    .vendor-btn.hbi-primary { border: 1px solid #FF5722; color: #FF5722; background: #2e1a1a; font-weight: bold; }
    .vendor-btn.panda-primary { border: 1px solid #fff; color: #fff; background: #444; font-weight: bold; }
    .vendor-btn.afg-primary { border: 1px solid #9C27B0; color: #9C27B0; background: #2a1a2e; font-weight: bold; }
    .vendor-btn.maple-primary { border: 1px solid #D32F2F; color: #D32F2F; background: #3e1a1a; font-weight: bold; } /* RED FOR MAPLE */

    .archive-btn { width: 100%; padding: 12px; background: #2c2c2c; color: #888; border: 1px dashed #555; border-radius: 8px; cursor: pointer; }
    .fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #2196F3; color: white; border-radius: 50%; border: none; font-size: 30px; box-shadow: 0 4px 10px #000; cursor: pointer; z-index: 900; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 1000; }
    .modal-box { background: #252525; padding: 25px; border-radius: 16px; width: 90%; max-width: 400px; }
    .input { width: 100%; padding: 12px; margin: 10px 0; background: #333; border: 1px solid #555; color: #fff; font-size: 16px; box-sizing: border-box; }
    .btn { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; }
    #loading { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:#00e676; align-items:center; justify-content:center; font-size:1.5em; z-index: 2000; }
  </style>
</head>
<body>
  <div id="loading">Updating Queue...</div>
  <h1 style="text-align:center;">VALLEY HEMP OS</h1>
  <div id="app" class="grid"></div>
  <button class="fab" onclick="document.getElementById('addModal').style.display='flex'">+</button>

  <div id="addModal" class="modal">
    <div class="modal-box">
      <h2>Add Item</h2>
      <input id="addBrand" class="input" placeholder="Brand (e.g. Puffco, RAW)">
      <input id="addItem" class="input" placeholder="Item Name">
      <input id="addLink" class="input" placeholder="Paste Direct Link (Optional)">
      <button class="btn" style="background:#2196F3; color:#fff;" onclick="submitItem()">Add Item</button>
      <button class="btn" style="background:#444; color:#fff;" onclick="document.getElementById('addModal').style.display='none'">Cancel</button>
    </div>
  </div>

<script>
    // --- PASTE YOUR WEB APP URL HERE ---
    const API_URL = 'https://script.google.com/macros/s/AKfycbwtIgaF1TJvJOmreUuiAn55fBXWR-gTb_x3O-CiCtq2J7vy9sZUGbZp-Kf43Jn3fwFP/exec';

    async function loadData() {
      try {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({action: "get"}) });
        const data = await res.json();
        render(data);
      } catch (e) { document.getElementById('app').innerHTML = '<div style="text-align:center; padding:50px;">Check API URL</div>'; }
    }

    function render(data) {
      const app = document.getElementById('app');
      app.innerHTML = '';
      data.slice(1).forEach(row => {
        // Updated Destructuring to catch the new Maple Link (Index 11)
        const [brand, item, , wcg, afg, panda, hbi, milky, , , customLink, maple] = row;
        if(!brand) return;
        
        const text = (brand + " " + item).toLowerCase();
        
        // --- VISUAL HIGHLIGHT LOGIC ---
        const hbiWords = ["raw", "elements", "juicy", "zen", "skunk", "dlx", "zig zag", "ocb", "job", "pure hemp", "king palm", "cyclones", "clipper", "zippo", "lighter", "torch", "smoke buddy", "mouthpeace", "cleaner", "orange chronic", "formula 420", "iso", "tray", "rolling", "roller", "scale", "tips", "cone", "paper"];
        const afgWords = ["pulsar", "grindhouse", "ooze", "lookah", "wulf", "yocan", "cali crusher", "santa cruz", "kannastor", "ryot", "mj arsenal", "empire glassworks", "grav", "shire", "dugout", "boveda", "incense", "candle", "stash"];
        const mapleWords = ["maple", "crown", "cannatonik", "spider", "nice glass", "shatter'd", "tech tubes", "blink", "newport", "high voltage", "rescue detox", "fictional", "stlth", "elfbar"];
        const pandaWords = ["generic", "no name", "value", "bulk", "cheap", "fantom", "titanium", "colibri"];
        
        let hbiClass = "", wcgClass = "", pandaClass = "", afgClass = "", mapleClass = "";

        if (hbiWords.some(w => text.includes(w))) { hbiClass = "hbi-primary"; } 
        else if (afgWords.some(w => text.includes(w))) { afgClass = "afg-primary"; }
        else if (mapleWords.some(w => text.includes(w))) { mapleClass = "maple-primary"; }
        else if (pandaWords.some(w => text.includes(w))) { pandaClass = "panda-primary"; }
        else { wcgClass = "wcg-primary"; }

        let buttons = [];
        if(wcg) buttons.push(`<a href="${wcg}" target="_blank" class="vendor-btn ${wcgClass}">WCG</a>`);
        if(hbi) buttons.push(`<a href="${hbi}" target="_blank" class="vendor-btn ${hbiClass}">HBI</a>`);
        if(maple) buttons.push(`<a href="${maple}" target="_blank" class="vendor-btn ${mapleClass}">Maple</a>`); // New Maple Button
        if(panda) buttons.push(`<a href="${panda}" target="_blank" class="vendor-btn ${pandaClass}">Panda</a>`);
        if(afg) buttons.push(`<a href="${afg}" target="_blank" class="vendor-btn ${afgClass}">AFG</a>`);
        if(milky) buttons.push(`<a href="${milky}" target="_blank" class="vendor-btn">Milky</a>`);

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="brand">${brand}</div>
          <div class="item-name">${item}</div>
          ${customLink ? `<a href="${customLink}" target="_blank" class="direct-link">ðŸ”— View Item</a>` : ''}
          <div class="vendor-grid">${buttons.join('')}</div>
          <button class="archive-btn" onclick="archive(this, '${brand}', '${item}')">âœ… Order Placed</button>
        `;
        app.appendChild(card);
      });
    }

    async function submitItem() {
      const brand = document.getElementById('addBrand').value;
      const item = document.getElementById('addItem').value;
      const link = document.getElementById('addLink').value;
      if(!brand) return;
      document.getElementById('addModal').style.display='none';
      document.getElementById('loading').style.display='flex';
      try {
        await fetch(API_URL, { method: 'POST', headers: { "Content-Type": "text/plain;charset=utf-8" }, body: JSON.stringify({action: "add_item", brand: brand, item: item, link: link}) });
      } catch (e) { console.log("Reloading"); }
      setTimeout(() => location.reload(), 1000);
    }

    async function archive(btn, brand, item) {
      if(!confirm("Order Placed?")) return;
      btn.innerText = "Archiving...";
      await fetch(API_URL, { method: 'POST', headers: { "Content-Type": "text/plain;charset=utf-8" }, body: JSON.stringify({action: "archive", brand: brand, item: item}) });
      btn.closest('.card').remove();
    }

    loadData();
  </script>
</body>
</html>  
